{% extends "chem/base.html" %}

{% block title %}{{ pagename }}{% endblock %}

{% block header %}
{{ block.super }}
<script>
{% autoescape on %}
function submitForm(name) {
    $("form input#id_molname").val(name);
    $("form#newform").submit();
}

$(function() {
    $("#id_post").click(function() {
        event.preventDefault();
        var a = $('#newform').serialize();
        $.post('', a, function(data) {
            var text = '<ul>Worked:';
            for (var i = 0; i < data["worked"].length; i++) {
                text += "<li>" + data["worked"][i][0] + " -- " + data["worked"][i][1] + "</li>";
            }
            text += "</ul><ul>Failed:";
            for (var i = 0; i < data["failed"].length; i++) {
                text += "<li>" + data["failed"][i][0] + " -- " + data["failed"][i][1] + "</li>";
            }
            text += "</ul>"

            var newdialog = $('<div id="id_results">' + text + '</div>');
            newdialog.dialog({
                modal: true,
                title: "Results",
                });
            },
            'json'
            );
        }
    );
});
{% endautoescape %}
</script>
{% endblock %}

{% block content %}
    <h1>{{ pagename }}</h1>
    <table class="centered">
        <tr>
            <th>Name</th>
            <th>gjf</th>
            <th>mol2</th>
            <th>Image</th>
            <th>Job</th>
            <th></th>
        </tr>
    {% for molecule, error, warning in molecules %}
        <tr {% if error %}id="error"{% elif warning %}id="warning"{% endif %}>
            <td>{{ molecule }}</td>
            {% if not error %}
                <td><a href="../{{ molecule }}.gjf{{ basis }}">gjf</a></td>
                <td><a href="../{{ molecule }}.mol2{{ basis }}">mol2</a></td>
                <td><a href="../{{ molecule }}.png">Image</a></td>
                <td><a onClick="submitForm('{{ molecule }}')">Job</a></td>
                <td><a href="../{{ molecule }}/report/">Report</a></td>
            {% else %}
                <td colspan='4'>{{ error }}</td>
                <td><a href="../{{ molecule }}/report/">Report</a></td>
            {% endif %}
        </tr>
    {% endfor %}
    </table>
    <div class="hide-container">
    <div class="hide-title">
        <a href="#">Job Form</a>
    </div>
    <div class="hide">
        <form id="newform" action="." method="get">
            <table>
                {{ form.as_table }}
            </table>
            {% if basis %}<input type="hidden" name="basis" value="{{ basis }}">{% endif %}
            <input type="hidden" id="id_molname" name="molname" value="">
            <table>
                <tr><th>
                    {% if user.is_authenticated %}
                        {% csrf_token %}
                        <input type="submit" value="Submit Job" id="id_post"/>
                    {% endif %}
                    <input type="reset" value="Reset" />
                </th></tr>
            </table>
        </form>
    </div>
    </div>
    <a href='../{{ pagename }}.zip'>Download All</a>
{% endblock %}